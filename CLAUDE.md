# 「今日の小さな善行」アプリ企画書（React Native + TypeScript版）

## 1. アプリ概要

「今日の小さな善行」は、「**少しだけど世界が良くなっている**」という実感をユーザーに提供する、シンプルで心温まるモバイルアプリです。ユーザーは毎日、アプリから提案される一つの小さな善行に取り組み、その達成を記録します。この小さな行動の積み重ねが、自分自身のポジティブな習慣となり、そして「世界全体の善行」の一部として可視化されることで、日々にささやかな喜びと、ゆるやかな連帯感をもたらします。

---

## 2. 目的

* **日々の生活へのポジティブな行動の促進:** ユーザーが日常生活の中で無理なく実践できる小さな善行を促し、ポジティブな行動習慣のきっかけを作ります。
* **自己肯定感の向上:** 自分の行動が「良いこと」に繋がっているという実感を通じて、自己肯定感を高めます。
* **ゆるやかな連帯感の醸成:** 友達が善行を達成したことを知ることで、直接的なコミュニケーションがなくとも、お互いの存在を意識し、前向きな気持ちを共有できるコミュニティ感を育みます。
* **「世界貢献」意識の可視化:** ユーザー個人の善行が、グローバルなポジティブな影響の一部であるという感覚を可視化し、より大きな意義を感じさせます。

---

## 3. ターゲットユーザー

* 日常にちょっとした変化やポジティブな刺激を求めている人
* 良い習慣を身につけたいけれど、なかなか続かないと感じている人
* SNS疲れを感じているが、人とのゆるやかな繋がりは持ちたい人
* 自分の行動が社会や世界に良い影響を与えることに喜びを感じる人

---

## 4. 主な機能

### 4.1. 毎日のお題提示

* **日替わりお題:** 毎日、特定の時刻に、事前に用意されたリストからランダムで「今日の小さな善行」が一つ提示されます。（例：「ありがとうを言う」「ゴミを一個拾う」「机を掃除する」「近所の人に挨拶をする」など）
* **お題のカテゴリ表示:** お題には、その善行が属するカテゴリ（例：環境、人間関係、自己ケアなど）をシンプルなアイコンで表示します。
* **お題の変更（1日1回）:** 提示されたお題が不都合な場合、1日1回に限り、別のお題にランダムで変更できます。

### 4.2. 善行の「DONE!」と達成フィードバック

* **ワンタップ完了:** 善行を達成したら、アプリ内の大きな「DONE!」ボタンをタップするだけで記録が完了します。
* **視覚的・聴覚的フィードバック:** 「DONE!」タップ時には、達成を称えるシンプルなアニメーション（例：キラキラ光る、花びらが舞うなど）と心地よい効果音を提供し、達成感を高めます。
* **貢献の示唆:** 達成直後に、「あなたのこの行動は、地球に少しの笑顔をもたらしました。」といった、善行がもたらすポジティブな影響を示すシンプルな一言メッセージが表示されます。
* **世界全体の「DONE!」カウンター:** アプリ内に、全ユーザーがこれまでに達成した「DONE!」の累計数、または今日の達成数をリアルタイムに近い形で表示し、「世界が良くなっている」感覚を可視化します。
* **「善行の光」アニメーション:** 「DONE!」時に、アプリ画面上の地球儀イラストやシンプルな世界地図のどこかに、小さな光が点滅・移動するようなアニメーションを挟み、自分の行動が世界に繋がったことを表現します。

### 4.3. 友達へのゆるやかな通知（フォロー機能）

* **一方向フォロー:** ユーザーは、他のユーザーのユニークIDを入力することで、そのユーザーをフォローできます。誰にフォローされているかは表示されません。
* **達成通知:** フォローしているユーザーが善行を「DONE!」すると、「〇〇さんが今日の小さな善行を達成しました！」というプッシュ通知が届きます。具体的なお題の内容は通知されません。
* **アプリ内での表示:** アプリのトップ画面などに、今日「DONE!」したフォロー中のユーザーの名前がシンプルに一覧表示されます。個別の達成回数や連続記録などの競争を煽る情報は表示しません。

### 4.4. 善行履歴（自分のみ）

* **シンプルなカレンダー表示:** 過去に自分が善行を達成した日を、カレンダー形式で視覚的に確認できます。
* **お題の再確認:** 日付をタップすることで、その日に自身が取り組んだお題を再確認できます（オプション）。
* **友達の履歴なし:** 個人の達成履歴は自分だけが見ることができます。

---

## 5. 技術スタック

* **モバイルアプリ開発:** **React Native（TypeScript）**
    * **多言語化（i18n）:** **`react-i18next`** などのライブラリを導入し、アプリ内のテキスト表示を多言語に対応させます。ユーザーのデバイス設定に基づいて言語を自動選択、または手動での切り替えを可能にします。
    * **理由:** 一つのコードベースでiOS/Android両方に対応できるため、開発効率が高く、Web開発の経験があれば学習コストを抑えられます。TypeScriptの導入により、開発時の型安全性が向上し、大規模なコードベースでも保守性が高まります。
* **バックエンド:** **Firebase**
    * **Firebase Authentication:** ユーザー認証（ログイン、アカウント管理）
    * **Cloud Firestore:** ドキュメントデータベース（ユーザー情報、お題データ、善行履歴、フォロー関係などの保存）
        * **多言語対応データ構造:** お題データ (`tasks` コレクション) など、多言語化が必要なテキストフィールドは、各言語のキーを持つオブジェクト形式で保存します（例: `text: { en: "Pick up one piece of trash.", ja: "ゴミを一個拾いましょう。" }`）。
    * **Cloud Functions:** サーバレス関数（毎日のお題選定ロジック、友達への通知トリガー、グローバルカウンターの集計など）
        * **多言語通知:** 通知メッセージを送信する際、ユーザーの言語設定（ユーザー情報に保存）に基づいて適切な言語のメッセージを生成します。
    * **Firebase Cloud Messaging (FCM):** プッシュ通知配信
    * **メリット:** BaaS（Backend as a Service）であり、インフラ管理の手間を大幅に削減し、開発速度とスケーラビリティを確保するため。

---

## 6. 開発プロセス（案）

1.  **企画・設計:** 詳細なUI/UX設計、機能要件定義、データ構造設計（多言語対応含む）。
2.  **プロトタイプ開発:**
    * **アプリ側先行:** React Native + TypeScriptでUI/UXの骨格と「DONE!」時のフィードバックを最優先で開発。初期はスタブデータやFirestoreへの直接読み書きで動作を確認。**この段階から、多言語化ライブラリを導入し、全ての表示テキストを外部ファイル化します。**
    * **Firebase連携:** Firebase Authenticationと主要データモデル（`users`, `tasks`, `daily_task_history`）を連携させ、基本的なデータの読み書きを実装。**お題データなど多言語化が必要なデータは、初めから多言語対応の構造で保存します。**
3.  **Cloud Functions実装:** 毎日のお題選定ロジックと友達通知ロジックを実装。ローカルエミュレータでデバッグ。**通知メッセージの生成ロジックに多言語対応を組み込みます。**
4.  **機能拡張:** フォロー機能、グローバルカウンター、履歴表示など、残りの機能を実装。
5.  **テスト・改善:** 各機能のテスト、結合テスト、パフォーマンス最適化。ユーザーテストを通じてUI/UXの改善。**多言語表示のテストも行います。**
6.  **CI/CD構築:** GitHub Actionsを用いて、モバイルアプリとCloud Functionsの自動テスト・デプロイパイプラインを構築。
7.  **リリース:** App StoreとGoogle Playへリリース。

---

## 7. リポジトリ戦略

* **シングルリポジトリ（モノレポ）での運用:**
    * **構造:** アプリケーションのフロントエンド（React Native）とバックエンド（Cloud Functions）のコードを、一つのGitリポジトリ内で管理します。
    * **理由:** 個人または少人数での開発において、**開発のシンプルさ、CI/CDの容易さ、コードベースの一貫性維持**を最優先するため。関連するコード変更を一つのコミットで管理でき、全体の開発効率が向上します。

---

## 8. 今後の展望

* ユーザーからのフィードバックを元に、お題のバリエーションの拡充や、達成フィードバックの改善を継続的に行う。
* （シンプルさを保ちつつ）ユーザーが自身のお題を登録できる機能や、特定のテーマ（例：環境チャレンジ週）など、期間限定のイベント要素の追加も検討の余地あり。

---

## 🚀 現在の開発進捗状況（2025年6月11日時点）

### ✅ 完了済み（フェーズ1: プロトタイプ開発）

#### 1. 基盤構築
- **モノレポ初期化** ✅ - apps/mobile/ 構成完了
- **React Native + TypeScript 環境** ✅ - Expo 53.0.11 ベース
- **テスト環境** ✅ - Jest + React Native Testing Library
- **多言語化** ✅ - react-i18next + 日本語・英語対応

#### 2. コアコンポーネント（TDD実装）
- **DoneButton** ✅ - ローディング・無効化状態対応
- **DoneFeedback** ✅ - キラキラアニメーション + 多言語メッセージ
- **DailyTask** ✅ - カテゴリ表示・お題変更・多言語対応
- **GlobalCounter** ✅ - 地球アニメーション・カウンター表示

#### 3. 完全動作デモアプリ
- **MainScreen** ✅ - 全コンポーネント統合
- **サンプルデータ** ✅ - 8種類の善行タスク
- **完全なUXフロー** ✅ - お題変更→DONE!→フィードバック→カウンター更新
- **Web動作確認済み** ✅ - http://localhost:8081

#### 4. 品質保証
- **テストカバレッジ** ✅ - 20/20 テストがパス
- **TypeScript型安全性** ✅ - 完全型定義
- **多言語対応** ✅ - UI・データ構造両方対応

### 📋 次回開始時のタスク（優先度順）

#### 【高優先度】Firebase連携 
1. **Firebase プロジェクト作成・設定**
   - Firebase Authentication セットアップ
   - Cloud Firestore データベース設計
   - Firebase SDK 導入・設定

2. **基本データモデル実装**
   - users コレクション（ユーザー情報・言語設定）
   - tasks コレクション（多言語お題データ）
   - daily_task_history コレクション（善行履歴）

3. **認証フロー実装**
   - 匿名認証 or 簡易サインアップ
   - ユーザー状態管理

#### 【中優先度】Cloud Functions
1. **毎日のお題選定ロジック**
   - 日替わりお題自動選定
   - ユーザー個別のお題管理
   
2. **グローバルカウンター集計**
   - リアルタイム善行カウンター
   - 日別・累計カウント

#### 【低優先度】拡張機能
1. **フォロー機能**
   - 一方向フォロー実装
   - 友達善行通知

2. **履歴機能**
   - カレンダー表示
   - 過去のお題確認

### 🛠 開発環境・コマンド

#### アプリ起動
```bash
cd /home/yoshiori/src/github.com/yoshiori/ichizen/apps/mobile
npx expo start --web  # Web版
npx expo start        # モバイル版（QRコード）
```

#### テスト実行
```bash
npm test              # 全テスト実行
npm run typecheck     # 型チェック
```

#### Git状態
- **最新コミット**: fc3c369 "Create fully functional demo app with integrated components"
- **ブランチ**: main
- **未追跡ファイル**: node_modules/, package-lock.json

### 🗂 重要なファイルパス
```
apps/mobile/
├── src/
│   ├── components/      # 実装済みコンポーネント
│   ├── screens/         # MainScreen
│   ├── data/           # サンプルタスクデータ
│   ├── i18n/           # 多言語設定
│   └── types/          # TypeScript型定義
├── __tests__/          # テストファイル（20個）
└── App.tsx            # エントリーポイント
```

---
