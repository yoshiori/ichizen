# 「今日の小さな善行」アプリ企画書（React Native + TypeScript版）

## 1. アプリ概要

「今日の小さな善行」は、「**少しだけど世界が良くなっている**」という実感をユーザーに提供する、シンプルで心温まるモバイルアプリです。ユーザーは毎日、アプリから提案される一つの小さな善行に取り組み、その達成を記録します。この小さな行動の積み重ねが、自分自身のポジティブな習慣となり、そして「世界全体の善行」の一部として可視化されることで、日々にささやかな喜びと、ゆるやかな連帯感をもたらします。

---

## 2. 目的

* **日々の生活へのポジティブな行動の促進:** ユーザーが日常生活の中で無理なく実践できる小さな善行を促し、ポジティブな行動習慣のきっかけを作ります。
* **自己肯定感の向上:** 自分の行動が「良いこと」に繋がっているという実感を通じて、自己肯定感を高めます。
* **ゆるやかな連帯感の醸成:** 友達が善行を達成したことを知ることで、直接的なコミュニケーションがなくとも、お互いの存在を意識し、前向きな気持ちを共有できるコミュニティ感を育みます。
* **「世界貢献」意識の可視化:** ユーザー個人の善行が、グローバルなポジティブな影響の一部であるという感覚を可視化し、より大きな意義を感じさせます。

---

## 3. ターゲットユーザー

* 日常にちょっとした変化やポジティブな刺激を求めている人
* 良い習慣を身につけたいけれど、なかなか続かないと感じている人
* SNS疲れを感じているが、人とのゆるやかな繋がりは持ちたい人
* 自分の行動が社会や世界に良い影響を与えることに喜びを感じる人

---

## 4. 主な機能

### 4.1. 毎日のお題提示

* **日替わりお題:** 毎日、特定の時刻に、事前に用意されたリストからランダムで「今日の小さな善行」が一つ提示されます。（例：「ありがとうを言う」「ゴミを一個拾う」「机を掃除する」「近所の人に挨拶をする」など）
* **お題のカテゴリ表示:** お題には、その善行が属するカテゴリ（例：環境、人間関係、自己ケアなど）をシンプルなアイコンで表示します。
* **お題の変更（1日1回）:** 提示されたお題が不都合な場合、1日1回に限り、別のお題にランダムで変更できます。

### 4.2. 善行の「DONE!」と達成フィードバック

* **ワンタップ完了:** 善行を達成したら、アプリ内の大きな「DONE!」ボタンをタップするだけで記録が完了します。
* **視覚的・聴覚的フィードバック:** 「DONE!」タップ時には、達成を称えるシンプルなアニメーション（例：キラキラ光る、花びらが舞うなど）と心地よい効果音を提供し、達成感を高めます。
* **貢献の示唆:** 達成直後に、「あなたのこの行動は、地球に少しの笑顔をもたらしました。」といった、善行がもたらすポジティブな影響を示すシンプルな一言メッセージが表示されます。
* **世界全体の「DONE!」カウンター:** アプリ内に、全ユーザーがこれまでに達成した「DONE!」の累計数、または今日の達成数をリアルタイムに近い形で表示し、「世界が良くなっている」感覚を可視化します。
* **「善行の光」アニメーション:** 「DONE!」時に、アプリ画面上の地球儀イラストやシンプルな世界地図のどこかに、小さな光が点滅・移動するようなアニメーションを挟み、自分の行動が世界に繋がったことを表現します。

### 4.3. 友達へのゆるやかな通知（フォロー機能）

* **一方向フォロー:** ユーザーは、他のユーザーのユニークIDを入力することで、そのユーザーをフォローできます。誰にフォローされているかは表示されません。
* **達成通知:** フォローしているユーザーが善行を「DONE!」すると、「〇〇さんが今日の小さな善行を達成しました！」というプッシュ通知が届きます。具体的なお題の内容は通知されません。
* **アプリ内での表示:** アプリのトップ画面などに、今日「DONE!」したフォロー中のユーザーの名前がシンプルに一覧表示されます。個別の達成回数や連続記録などの競争を煽る情報は表示しません。

### 4.4. 善行履歴（自分のみ）

* **シンプルなカレンダー表示:** 過去に自分が善行を達成した日を、カレンダー形式で視覚的に確認できます。
* **お題の再確認:** 日付をタップすることで、その日に自身が取り組んだお題を再確認できます（オプション）。
* **友達の履歴なし:** 個人の達成履歴は自分だけが見ることができます。

---

## 5. 技術スタック

* **モバイルアプリ開発:** **React Native（TypeScript）**
    * **多言語化（i18n）:** **`react-i18next`** などのライブラリを導入し、アプリ内のテキスト表示を多言語に対応させます。ユーザーのデバイス設定に基づいて言語を自動選択、または手動での切り替えを可能にします。
    * **理由:** 一つのコードベースでiOS/Android両方に対応できるため、開発効率が高く、Web開発の経験があれば学習コストを抑えられます。TypeScriptの導入により、開発時の型安全性が向上し、大規模なコードベースでも保守性が高まります。
* **バックエンド:** **Firebase**
    * **Firebase Authentication:** ユーザー認証（ログイン、アカウント管理）
    * **Cloud Firestore:** ドキュメントデータベース（ユーザー情報、お題データ、善行履歴、フォロー関係などの保存）
        * **多言語対応データ構造:** お題データ (`tasks` コレクション) など、多言語化が必要なテキストフィールドは、各言語のキーを持つオブジェクト形式で保存します（例: `text: { en: "Pick up one piece of trash.", ja: "ゴミを一個拾いましょう。" }`）。
    * **Cloud Functions:** サーバレス関数（毎日のお題選定ロジック、友達への通知トリガー、グローバルカウンターの集計など）
        * **多言語通知:** 通知メッセージを送信する際、ユーザーの言語設定（ユーザー情報に保存）に基づいて適切な言語のメッセージを生成します。
    * **Firebase Cloud Messaging (FCM):** プッシュ通知配信
    * **メリット:** BaaS（Backend as a Service）であり、インフラ管理の手間を大幅に削減し、開発速度とスケーラビリティを確保するため。

---

## 6. 開発プロセス（案）

1.  **企画・設計:** 詳細なUI/UX設計、機能要件定義、データ構造設計（多言語対応含む）。
2.  **プロトタイプ開発:**
    * **アプリ側先行:** React Native + TypeScriptでUI/UXの骨格と「DONE!」時のフィードバックを最優先で開発。初期はスタブデータやFirestoreへの直接読み書きで動作を確認。**この段階から、多言語化ライブラリを導入し、全ての表示テキストを外部ファイル化します。**
    * **Firebase連携:** Firebase Authenticationと主要データモデル（`users`, `tasks`, `daily_task_history`）を連携させ、基本的なデータの読み書きを実装。**お題データなど多言語化が必要なデータは、初めから多言語対応の構造で保存します。**
3.  **Cloud Functions実装:** 毎日のお題選定ロジックと友達通知ロジックを実装。ローカルエミュレータでデバッグ。**通知メッセージの生成ロジックに多言語対応を組み込みます。**
4.  **機能拡張:** フォロー機能、グローバルカウンター、履歴表示など、残りの機能を実装。
5.  **テスト・改善:** 各機能のテスト、結合テスト、パフォーマンス最適化。ユーザーテストを通じてUI/UXの改善。**多言語表示のテストも行います。**
6.  **CI/CD構築:** GitHub Actionsを用いて、モバイルアプリとCloud Functionsの自動テスト・デプロイパイプラインを構築。
7.  **リリース:** App StoreとGoogle Playへリリース。

---

## 7. リポジトリ戦略

* **シングルリポジトリ（モノレポ）での運用:**
    * **構造:** アプリケーションのフロントエンド（React Native）とバックエンド（Cloud Functions）のコードを、一つのGitリポジトリ内で管理します。
    * **理由:** 個人または少人数での開発において、**開発のシンプルさ、CI/CDの容易さ、コードベースの一貫性維持**を最優先するため。関連するコード変更を一つのコミットで管理でき、全体の開発効率が向上します。

---

## 8. 今後の展望

* ユーザーからのフィードバックを元に、お題のバリエーションの拡充や、達成フィードバックの改善を継続的に行う。
* （シンプルさを保ちつつ）ユーザーが自身のお題を登録できる機能や、特定のテーマ（例：環境チャレンジ週）など、期間限定のイベント要素の追加も検討の余地あり。

---

## 🚀 開発作業ログ（2025年6月11日）

### ✅ 完了済み（フェーズ2: Firebase連携基盤構築）

#### 1. 環境アップグレード
- **Node.js アップグレード** ✅ - v18.19.1 → v20.19.2
- **npm アップグレード** ✅ - v9.2.0 → v10.8.2
- **Firebase Tools 対応** ✅ - v14.6.0 利用可能
- **依存関係再構築** ✅ - legacy-peer-deps で解決

#### 2. Firebase SDK 導入・設定
- **Firebase SDK インストール** ✅ - firebase@latest
- **Firebase 設定ファイル** ✅ - `src/config/firebase.ts`
- **開発環境設定** ✅ - `src/config/firebase.dev.ts`
- **エミュレータ設定** ✅ - firebase.json, firestore.rules

#### 3. データモデル・型定義
- **Firebase型定義** ✅ - `src/types/firebase.ts`
- **User, Task, DailyTaskHistory, GlobalCounter** ✅ - 完全型安全
- **多言語対応構造** ✅ - `{ ja: string, en: string }` 形式
- **Timestamp型対応** ✅ - Firestore互換性確保

#### 4. 認証・サービス層実装
- **AuthContext** ✅ - `src/contexts/AuthContext.tsx`
- **匿名認証フロー** ✅ - `src/services/auth.ts`
- **Firestore CRUD** ✅ - `src/services/firestore.ts`
- **グローバルカウンター** ✅ - 日別リセット機能付き

#### 5. 既存コンポーネント移行
- **DailyTask コンポーネント** ✅ - Firebase型対応
- **MainScreen 統合** ✅ - 認証・データフロー実装
- **サンプルデータ更新** ✅ - 多言語カテゴリ対応
- **App.tsx 更新** ✅ - AuthProvider統合

#### 6. 品質保証・テスト
- **型チェック** ✅ - TypeScript 完全パス
- **テストスイート** ✅ - 20/20 テスト成功
- **Jest型定義** ✅ - @types/jest@latest
- **i18n 設定更新** ✅ - compatibilityJSON v4

#### 7. Firestore設定
- **セキュリティルール** ✅ - firestore.rules
- **インデックス設定** ✅ - firestore.indexes.json
- **エミュレータ構成** ✅ - Auth:9099, Firestore:8080

### 🔧 解決した技術課題
1. **Node.js互換性** - NodeSource リポジトリ経由でv20導入
2. **React依存関係競合** - --legacy-peer-deps で解決
3. **Firebase Timestamp型** - instanceof Date チェック追加
4. **テスト型定義** - @types/jest 明示的インストール

### 📋 次回開始時のタスク（優先度順）

#### 【高優先度】Firebase実環境セットアップ
1. **Firebase プロジェクト作成**
   - Firebase Console でプロジェクト作成
   - Authentication 有効化
   - Firestore データベース作成

2. **初期データ投入**
   - サンプルタスクデータをFirestoreに登録
   - グローバルカウンター初期化
   - セキュリティルール・インデックスデプロイ

3. **Firebase Emulator 起動テスト**
   - `npx firebase emulators:start`
   - アプリ連携動作確認

#### 【中優先度】Cloud Functions開発
1. **毎日のお題選定ロジック**
   - ユーザー別日替わりタスク管理
   - タイムゾーン対応

2. **プッシュ通知基盤**
   - FCM設定・トークン管理
   - フォロー通知システム

#### 【低優先度】機能拡張
1. **履歴画面実装**
2. **フォロー機能実装**

### 🛠 開発環境・コマンド

#### 現在の環境
- **Node.js**: v20.19.2
- **npm**: v10.8.2  
- **作業ディレクトリ**: `/home/yoshiori/src/github.com/yoshiori/ichizen/apps/mobile`

#### アプリ起動
```bash
npx expo start --web  # Web版
npx expo start        # モバイル版（QRコード）
```

#### テスト・型チェック
```bash
npm test -- --watchAll=false  # 全テスト実行
npm run typecheck             # TypeScript型チェック
```

#### Firebase Emulator
```bash
cd /home/yoshiori/src/github.com/yoshiori/ichizen
npx firebase emulators:start  # エミュレータ起動
```

### 📊 Git状態
- **最新コミット**: 3311040 "Integrate Firebase SDK with authentication and Firestore data layer"
- **ブランチ**: main
- **コミット状況**: origin/main より1コミット先行

### 🗂 新規追加ファイル構造
```
apps/mobile/src/
├── config/
│   ├── firebase.ts          # 本番Firebase設定
│   └── firebase.dev.ts      # 開発Firebase設定
├── contexts/
│   └── AuthContext.tsx      # 認証状態管理
├── services/
│   ├── auth.ts              # 認証サービス
│   └── firestore.ts         # Firestoreサービス
└── types/
    └── firebase.ts          # Firebase型定義

プロジェクトルート/
├── firebase.json            # Firebase設定
├── firestore.rules          # セキュリティルール
└── firestore.indexes.json   # Firestoreインデックス
```

### 🎯 開発継続のポイント
1. **Firebase実プロジェクトの作成が最優先**
2. **エミュレータでローカル開発可能**
3. **すべての基盤コードは実装済み**
4. **テスト・型安全性は完全に確保済み**

---
